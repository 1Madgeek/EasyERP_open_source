<div id="noteBody" class="noteMainContainer">
    <% notes = notes || [];%>
    <% notes.reverse();%>
    <%_.each(notes, function(val,key){ %>
    <% var login = val.user ? (App.currentUser._id === val.user._id) ? 'You': val.user.login : '' %>
    <% var classType = val.task ? 'taskContent' : val.history ? 'historyContent' : 'noteContent' %>
    <div id="<%=val._id%>" class="noteContainer <%=classType%>">
        <div class="itemCircle">
            <i class="fa fa-circle-o" aria-hidden="true"></i>
        </div>
        <div class="itemCircle">
            <i class="fa fa-calendar" aria-hidden="true"></i>
        </div>
        <div class="itemCircle">
            <i class="fa fa-usd" aria-hidden="true"></i>
        </div>

        <div class="<%=val.history ? '' : 'contentHolder'%>">
            <div class="noteBody">
                <%if (val.task){%>
                <div class="noteType task" id="<%= val.task._id%>">
                    <span class="noteUserTitle"><b><%= login %></b> created task</span>
                    <p class="dateNote"><%=val.date%></p>
                    <div class="noteContent"><a href="javascript:;" ><%=val.task.description  %></a></div>
                </div>
                <div class="assignedTo">Assigned To <b><%=val.task && val.task.assignedTo ? val.task.assignedTo.fullName : ''%></b></div>
                <%} else if (val.history) {%>
                <div class="history_body">
                    <div class="history_changed">
                        <span class="dateNote"><%=val.date%></span>
                        <div class="changed_field">
                            <%if (val.history.prevValue){%>
                            <span class="changedFieldName"><%= login + ' changed ' + val.history.changedField %></span>
                            <span>from <%= val.history.prevValue %></span>
                            <span> to </span>
                            <%} else {%>
                            <span class="changedFieldName"><%=login + ' added ' + val.history.changedField %></span>
                            <%}%>
                            <span><%= val.history.newValue || '' %></span>
                        </div>
                    </div>
                </div>
                <%} else {%>
                <div>
                    <span class="noteType"><b><%=login%></b> left a Note</span>
                    <span class="dateNote"><%=val.date%></span>
                </div>
                <%}%>
                <% if (val.note){%>
                <div class="noteText"><%=val.note ? val.note.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\n/g,"<br/>") : '' %> </div>

                <%}%>
                <% if (val.attachment){%>

                <div class="noteType"><a href="download/<%= val.attachment.shortPas%>" id="<%= val.attachment._id%>"><%= val.attachment.name  %></a></div>
                <%}%>
            </div>
            <div class="noteBtnBlock">
                <a href="javascript:;" data-type="edit" class="editDelNote btn btnRounded editNote">Edit</a>

                <a href="javascript:;" data-type="del" class="editDelNote btn btnRounded">Del</a>
            </div>
        </div>
    </div>
    <% }); notes.reverse(); %>
</div>